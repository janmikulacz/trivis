# ***TřiVis***: Triangular Visibility C++ Library

## About ***TřiVis***

***TřiVis*** is a **fast**, **robust**, **versatile**, **self-contained** C++ library for computing **2D visibility-related structures**.

* **Fast:** It was evaluated on complex map instances.
The full results are in [1].
For example, on a map with *n=1055* (no. of vertices), *h=63* (no. of holes), ***TřiVis*** computes visibility regions for 1 million random query points in 4.51 microseconds on average. 
On a map with *n=8068*, *h=675*, it takes 10.23 microseconds on average. 
*Experimental setup:* personal laptop Legion 5 Pro 16ITH6H with Intel Core i7-11800H (4.60 GHz), 16 GB of RAM, and running Ubuntu 20.04.5 LTS.
* **Robust:** It uses robust geometry. It handles close points, queries on map vertices or edges.
* **Versatile:** In many ways. It computes visibility regions, all visible vertices of the map, two-point visibility, and visibility graphs. 
It can consider a limited visibility range, which results in lower run times. 
Visibility regions come with edge and vertex flags to provide topology information.
* **Self-contained:** 
It can be easily included by other projects.
The library is internally dependent on [*Triangle*](https://www.cs.cmu.edu/~quake/triangle.html), [*Robust geometric predicates*](https://github.com/dengwirda/robust-predicate), and [*Clipper2*](http://www.angusj.com/clipper2/Docs/Overview.htm). 
However, thanks to being open-source, ***TřiVis*** directly contains their source files.


### The Name

We originally introduced ***TřiVis*** under the name ***TriVis*** in [2].
***TriVis*** stands for ***Tri***angular **Vis**ibility.
The third version of the library was presented in [1] under the name ***TřiVis***.
***Tři*** means ***three*** in Czech.
The correct Czech pronunciation of ***TřiVis*** is */tr̝̊ɪˈvɪz/*, but */trɪˈvɪz/* is also fine.
Since the third version, ***TřiVis*** is the library's official name.

## Building ***TřiVis*** and Running the Examples

### Example Project

***TřiVis*** is distributed as part of example project [`trivis_plus`](trivis_plus) with additional dependencies: [Boost](https://www.boost.org/) (used for logging, filesystem, argument parsing, etc.) and [Cairo](https://www.cairographics.org/) (used for drawing).
Please use the links to access the dependencies' websites and follow the installation instructions.

### The Library Itself

***TřiVis*** itself is located in [`trivis_plus/libs/trivis`](trivis_plus/libs/trivis).
Any project can easily include ***TřiVis*** simply by copying its files, adding `add_subdirectory(path/to/trivis)` to its CMakeLists.txt, and linking its executables or libraries by adding `target_link_libraries(my_exec TriVis)`.
Exactly the same is done by the example project.

### Building the Project and Running the Examples

The example project can be built easily by running [`bash build.bash`](build.bash). 
File [`build.bash.out`](build.bash.out) shows the standard output of a successful build.
After running the build script, four executables will appear in the build directory: `example_visibility_graph`, `example_visibility_map_vertices`, `example_visibility_region`, and `example_visibility_two_points`.
Try running each of the executables without any arguments.
Then check the [`out`](out) directory containing a nice picture generated by each run.
A picture is worth a thousand words. 
After checking the pictures, we are sure you will understand what ***TřiVis*** can do.

### More About the Examples

Play with the examples!
Running `example_<...> --help` will show available options and their default values.
For example, you can change the map, query points' coordinates, and the visibility radius.
The examples load maps from the [data/maps](data/maps) directory by default.
To change the map, you can just use the map name, e.g., `--map-name potholes`.
Be careful if you want to try the maps starting with `scene_<...>`.
For these, you need to include `--map-scale 1` (default value is `0.01`).

After you are done running the examples for fun, check their source files in [trivis_plus](trivis_plus). 
The code is self-explanatory and will give you a good idea of how to use ***TřiVis***.

### Map Format

The example project loads maps from simple TXT files with the following structure:

````
           # NOTE: Comments starting with # are not part of the structure.
           # NOTE: Angle brackets <> are substitutes for some user-defined values.
           
[SCALE]    # Default scale of the map (can be overwritten by --map-scale).
<scale>    # float
           
[BORDER]   # Vertices (x, y coordinates) of the free space boundary.
<x0> <y0>  # float float
...        
<xn> <yn>  # float float
           
           # NOTE: Only one definition of [BORDER] is possible.
           
[OBSTACLE] # Vertices (x, y coordinates) of the first obstacle, i.e., hole inside of [BORDER].
<x0> <y0>  # float float
...        # NOTE: All vertices must by inside [BORDER].
<xn> <yn>  # float float
           
...        # The number of obstacles is not limited.
           
[OBSTACLE] # Vertices (x, y coordinates) of the last obstacle.
<x0> <y0>  # float float
...        # NOTE: All vertices must by inside [BORDER].
<xn> <yn>  # float float
           
           # NOTE: All defined polygons must be simple (i.e., no self-intersections)! 
           # NOTE: The polygons also cannot intersect each other!
````

## Troubleshooting

In case of any problems, please write an email to [jan.mikula@cvut.cz](mailto:jan.mikula@cvut.cz). 

## References

[1] Mikula, J., & Kulich, M. (2023?). **Optimizing Mesh to Improve the Triangular Expansion Algorithm for Computing Visibility Regions.** Submitted to *SN Computer Science* on November 2022.

[2] Mikula, J., & Kulich, M. (2022). **Triangular Expansion Revisited: Which Triangulation Is the Best?** In: *Proceedings of the 19th International Conference on Informatics in Control, Automation and Robotics - ICINCO*, pp 313-319.
